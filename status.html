<?php session_start();?>
<!DOCTYPE html>
<head>
	<link rel="stylesheet" type="text/css" href="styles/ghs_style.css">
	<title>Status</title>
	<?php require "ghslib.php";?>
</head>
<body>
	<?php require "header.php";?>
<div class="content">
	<?php require "nav.php";?>
	<?php
		$n = $_SESSION['uname']; 
		$dbCon = dbConnect();
		$stmt = $dbCon->prepare("SELECT AccountId FROM Users WHERE Username=?;");
		$stmt->bind_param("s", $n);
		$stmt->execute();
		$stmt->bind_result($accountID);
		$stmt->fetch();
		$stmt->close();
	?>
	<h2>Welcome <?php echo $n; ?>!</h2>
	<?php
		$stmt = $dbCon->prepare("SELECT Title, VirtualMachineId, IP, isRunning 
				 	 FROM VirtualMachine, Game 
				 	 WHERE AccountId=? AND Game.GameId = VirtualMachine.GameId;");
		$stmt->bind_param("i", $accountID);
		$stmt->execute();
		$stmt->bind_result($Title, $VirtualMachineId, $IP, $isRunning);
		while ($stmt->fetch()){
			echo '<div class="vm">';
			echo "<h3>ID: $VirtualMachineId</h3><br>";
			if ($isRunning){
				echo "<table><td>IP:</td><td>$IP</td><td>Game:</td><td>$Title</td></table><br>";
				echo "Status: $isRunning";
			} else {
				
				echo '<form action="" method="POST">
					<select name="game">
						<option value="1">Minecraft</option>
					</select>
				      	<input type="submit" value="start/stop">
				      </form>';
			}
		echo "</div>";
		}
		$stmt->close();
		$dbCon->close();
	?>

	<form action="purchase.html" method="post">
		<input type="submit" value="Buy a VM!">
	</form>
	<?php require "footer.php";?>
</div>
</body>
</html>
